<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.dingdong.mapper.DingDongFileMapper">
    <resultMap id="dingDongFileMap" type="com.dingdong.domain.model.DingDongFile">
        <id column="id" property="id"/>
        <result column="file_name" property="fileName"></result>
        <result column="uploaded_name" property="uploadedName"></result>
        <result column="file_path" property="filePath"></result>
        <result column="product_id" property="productId"></result>
        <result column="file_type" property="fileType"></result>
    </resultMap>

    <insert id="insert" parameterType="com.dingdong.domain.model.DingDongFile" useGeneratedKeys="true" keyProperty="id">
        insert into file(
        <trim prefix="" prefixOverrides=",">
            <if test="fileName != null and fileName.trim() !=''">,file_name</if>
            <if test="uploadedName != null and uploadedName.trim() !=''">,uploaded_name</if>
            <if test="filePath != null and filePath.trim() !=''">,file_path</if>
            <if test="productId != null">,product_id</if>
            <if test="fileType != null">,file_type</if>
        </trim>
        )values(
        <trim prefix="" prefixOverrides=",">
            <if test="fileName != null and fileName.trim() !=''">,#{fileName,jdbcType=VARCHAR}</if>
            <if test="uploadedName != null and uploadedName.trim() !=''">,#{uploadedName,jdbcType=VARCHAR}</if>
            <if test="filePath != null and filePath.trim() !=''">,#{filePath,jdbcType=VARCHAR}</if>
            <if test="productId != null">,#{productId,jdbcType=BIGINT}</if>
            <if test="fileType != null">,#{fileType,jdbcType=INTEGER}</if>
        </trim>
        )
    </insert>

    <update id="update" parameterType="com.dingdong.domain.model.DingDongFile">
        update file
        <set>
            <if test="fileName != null and fileName.trim() !=''">file_name = #{fileName,jdbcType=VARCHAR},</if>
            <if test="uploadedName != null and uploadedName.trim() !=''">uploaded_name = #{uploadedName,jdbcType=VARCHAR},</if>
            <if test="filePath != null and filePath.trim() !=''">file_path = #{filePath,jdbcType=VARCHAR},</if>
            <if test="productId != null">product_id = #{productId,jdbcType=BIGINT},</if>
            <if test="fileType != null">file_type = #{fileType,jdbcType=INTEGER}</if>
        </set>
        where id=#{id}
    </update>

    <select id="load" parameterType="long" resultMap="dingDongFileMap">
        select * from file where id=#{id}
    </select>

    <sql id="queryCommonSql">
        FROM file f
        <where>
            <if test="idArray != null">
                f.id in
                <foreach collection="idArray" index="index" item="item" open="(" separator="," close="),">#{item}
                </foreach>
            </if>
            <if test="fileName != null and fileName.trim() !=''">and f.file_name = #{fileName}</if>
            <if test="uploadedName != null and uploadedName.trim() !=''">and f.uploaded_name = #{uploadedName}</if>
            <if test="filePath != null and filePath.trim() !=''">and f.file_path = #{filePath}</if>
            <if test="productId != null">and f.product_id = #{productId}</if>

        </where>
    </sql>

    <select id="queryList" parameterType="com.dingdong.domain.query.DingDongFileQuery" resultMap="dingDongFileMap">
        select f.id,f.file_name,f.uploaded_name,f.file_path,f.product_id
        <include refid="queryCommonSql"/>
        <if test="pageSize > 0">
            limit #{pageNo},#{pageSize}
        </if>
    </select>

    <select id="queryCount" parameterType="com.dingdong.domain.query.DingDongFileQuery" resultType="int">
        select count(1)
        <include refid="queryCommonSql" />
    </select>
</mapper>